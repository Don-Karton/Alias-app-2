<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Alias Game - DiSpace</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
            overflow-x: hidden;
        }

        /* Обновленный лоадер без круга */
        .loader {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            color: white;
        }

        .loader-logo {
            font-size: 48px;
            font-weight: bold;
            margin-bottom: 40px;
            animation: logoGlow 2s ease-in-out infinite;
            text-shadow: 0 0 20px rgba(255,255,255,0.5);
        }

        .loader-progress {
            width: 300px;
            height: 12px;
            background: rgba(255,255,255,0.2);
            border-radius: 20px;
            overflow: hidden;
            margin-bottom: 20px;
            position: relative;
            box-shadow: inset 0 2px 10px rgba(0,0,0,0.2);
        }

        .loader-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #fff 0%, #a8edea 50%, #fed6e3 100%);
            border-radius: 20px;
            width: 0%;
            animation: progressWave 3s ease-in-out forwards;
            box-shadow: 0 0 20px rgba(255,255,255,0.6);
            position: relative;
        }

        .loader-progress-bar::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            animation: shimmer 2s infinite;
        }

        .loader-text {
            font-size: 18px;
            font-weight: 600;
            opacity: 0.9;
            animation: textPulse 2s ease-in-out infinite;
        }

        @keyframes logoGlow {
            0%, 100% { 
                text-shadow: 0 0 20px rgba(255,255,255,0.5);
                transform: scale(1);
            }
            50% { 
                text-shadow: 0 0 30px rgba(255,255,255,0.8), 0 0 40px rgba(255,255,255,0.6);
                transform: scale(1.05);
            }
        }

        @keyframes progressWave {
            0% { 
                width: 0%; 
                box-shadow: 0 0 20px rgba(255,255,255,0.3);
            }
            50% { 
                width: 70%; 
                box-shadow: 0 0 30px rgba(255,255,255,0.7);
            }
            100% { 
                width: 100%; 
                box-shadow: 0 0 40px rgba(255,255,255,0.9);
            }
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(300px); }
        }

        @keyframes textPulse {
            0%, 100% { opacity: 0.7; }
            50% { opacity: 1; }
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
            padding: 10px;
            min-height: 100vh;
        }

        .page {
            display: none;
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            animation: fadeIn 0.3s ease-in;
            min-height: calc(100vh - 20px);
            position: relative;
        }

        .page.active {
            display: block;
        }

        /* Обновленная кнопка звука с выпадающим меню */
        .sound-control {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
        }

        .sound-toggle-main {
            width: 50px;
            height: 50px;
            border: none;
            border-radius: 50%;
            background: rgba(102, 126, 234, 0.9);
            color: white;
            font-size: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }

        .sound-toggle-main:hover {
            background: rgba(102, 126, 234, 1);
            transform: scale(1.1);
        }

        .sound-toggle-main.muted {
            background: rgba(244, 67, 54, 0.9);
        }

        .sound-dropdown {
            position: absolute;
            top: 60px;
            right: 0;
            background: white;
            border-radius: 15px;
            padding: 10px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
            display: none;
            flex-direction: column;
            gap: 8px;
            min-width: 200px;
        }

        .sound-dropdown.show {
            display: flex;
        }

        .sound-dropdown-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            border: none;
            border-radius: 10px;
            background: transparent;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
            color: #333;
        }

        .sound-dropdown-item:hover {
            background: #f5f5f5;
        }

        .sound-dropdown-item .icon {
            font-size: 18px;
            width: 20px;
            text-align: center;
        }

        /* Улучшенная шапка игрового экрана */
        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            background: rgba(255,255,255,0.15);
            border-radius: 15px;
            margin-bottom: 20px;
            color: white;
            backdrop-filter: blur(10px);
        }

        .game-score {
            font-size: 18px;
            font-weight: 600;
        }

        .game-controls {
            display: flex;
            gap: 10px;
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1001;
        }

        .control-btn {
            width: 45px;
            height: 45px;
            border: none;
            border-radius: 50%;
            background: rgba(255,255,255,0.9);
            color: #667eea;
            font-size: 18px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
            backdrop-filter: blur(10px);
        }

        .control-btn:hover {
            background: white;
            transform: scale(1.1);
        }

        .control-btn.muted {
            background: rgba(255,0,0,0.9);
            color: white;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        h1, h2 {
            text-align: center;
            margin-bottom: 30px;
            color: #667eea;
        }

        h1 {
            font-size: clamp(24px, 6vw, 32px);
        }

        h2 {
            font-size: clamp(20px, 5vw, 24px);
        }

        .menu-button {
            display: block;
            width: 100%;
            padding: 18px;
            margin: 10px 0;
            border: none;
            border-radius: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-size: clamp(16px, 4vw, 18px);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            touch-action: manipulation;
        }

        .menu-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .menu-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Новое горизонтальное меню в нижней части стартовой страницы */
        .bottom-menu {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 40px 0 20px 0;
            padding: 20px;
            border-top: 1px solid #e0e0e0;
            border-bottom: 1px solid #e0e0e0;
        }

        .bottom-menu-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            padding: 15px;
            border: none;
            background: transparent;
            cursor: pointer;
            transition: all 0.3s ease;
            border-radius: 15px;
            min-width: 70px;
        }

        .bottom-menu-item:hover {
            background: #f5f5f5;
            transform: translateY(-2px);
        }

        .bottom-menu-item .icon {
            font-size: 24px;
            margin-bottom: 5px;
        }

        .bottom-menu-item .label {
            font-size: 12px;
            color: #666;
            text-align: center;
            line-height: 1.2;
        }

        .team-list {
            margin: 20px 0;
        }

        .team-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 15px;
            margin: 10px 0;
            background: #f7f7f7;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            touch-action: manipulation;
        }

        .team-item:hover {
            background: #e9e9e9;
        }

        .team-name {
            font-size: clamp(16px, 4vw, 18px);
            font-weight: 500;
        }

        .team-score {
            font-size: clamp(20px, 5vw, 24px);
            font-weight: bold;
            color: #667eea;
        }

        .add-team-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 60px;
            height: 60px;
            margin: 20px auto;
            border: 3px dashed #667eea;
            border-radius: 50%;
            background: white;
            color: #667eea;
            font-size: 30px;
            cursor: pointer;
            transition: all 0.3s ease;
            touch-action: manipulation;
        }

        .add-team-btn:hover {
            background: #667eea;
            color: white;
        }

        .category-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .category-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 15px;
            background: white;
            font-size: clamp(14px, 3vw, 16px);
            cursor: pointer;
            transition: all 0.3s ease;
            touch-action: manipulation;
            min-height: 100px;
            position: relative;
        }

        .category-btn:hover {
            border-color: #667eea;
            transform: translateY(-2px);
        }

        .category-btn.selected {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .category-icon {
            font-size: 28px;
            margin-bottom: 8px;
        }

        .category-tooltip {
            font-size: 12px;
            opacity: 0.7;
            text-align: center;
            margin-top: 5px;
        }

        /* Новый стиль барабана для сложности */
        .difficulty-selector {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            margin: 30px 0;
            background: #f8f9fa;
            border-radius: 15px;
            padding: 30px 20px;
            border: 1px solid #e9ecef;
        }

        .difficulty-btn {
            width: 50px;
            height: 50px;
            border: 2px solid #667eea;
            border-radius: 50%;
            background: white;
            color: #667eea;
            font-size: 24px;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            user-select: none;
        }

        .difficulty-btn:hover {
            background: #667eea;
            color: white;
            transform: scale(1.1);
        }

        .difficulty-display {
            min-width: 150px;
            text-align: center;
            padding: 20px;
            background: white;
            border-radius: 15px;
            border: 2px solid #e9ecef;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .difficulty-level {
            font-size: 32px;
            margin-bottom: 8px;
        }

        .difficulty-name {
            font-size: 18px;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 5px;
        }

        .difficulty-desc {
            font-size: 12px;
            color: #666;
        }

        /* Настройки игры с новым дизайном */
        .settings-group {
            margin: 30px 0;
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            border: 1px solid #e9ecef;
        }

        .settings-group label {
            display: block;
            margin-bottom: 15px;
            font-weight: 600;
            font-size: clamp(16px, 4vw, 18px);
            color: #667eea;
            text-align: center;
        }

        .setting-control {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            margin: 20px 0;
        }

        .setting-btn {
            width: 45px;
            height: 45px;
            border: 2px solid #667eea;
            border-radius: 50%;
            background: white;
            color: #667eea;
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            user-select: none;
        }

        .setting-btn:hover {
            background: #667eea;
            color: white;
            transform: scale(1.1);
        }

        .setting-btn:active {
            transform: scale(0.95);
        }

        .setting-value {
            min-width: 80px;
            text-align: center;
            font-size: clamp(24px, 6vw, 32px);
            font-weight: bold;
            color: #667eea;
            padding: 10px 20px;
            background: white;
            border-radius: 15px;
            border: 2px solid #e9ecef;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
        }

        .bet-slider {
            width: 100%;
            height: 8px;
            border-radius: 5px;
            background: #ddd;
            outline: none;
            -webkit-appearance: none;
            margin: 20px 0;
        }

        .bet-slider::-webkit-slider-thumb {
            appearance: none;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
            box-shadow: 0 2px 6px rgba(0,0,0,0.3);
        }

        .bet-slider::-moz-range-thumb {
            width: 25px;
            height: 25px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
            border: none;
            box-shadow: 0 2px 6px rgba(0,0,0,0.3);
        }

        .bet-value {
            text-align: center;
            font-size: 18px;
            font-weight: bold;
            color: #667eea;
            margin-top: 10px;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 20px 0;
            gap: 15px;
            background: white;
            padding: 15px;
            border-radius: 10px;
            border: 2px solid #e9ecef;
        }

        .checkbox-group input[type="checkbox"] {
            width: 24px;
            height: 24px;
            accent-color: #667eea;
        }

        .checkbox-group label {
            font-size: clamp(14px, 3vw, 16px);
            margin: 0;
            color: #333;
            text-align: left;
        }

        /* Улучшенное игровое поле */
        .game-area {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 40vh;
            position: relative;
            margin: 20px 0;
        }

        .game-card {
            position: relative;
            width: min(320px, 85vw);
            height: min(320px, 35vh);
            background: linear-gradient(135deg, #fff 0%, #f8f9fa 100%);
            border: 4px solid #667eea;
            border-radius: 25px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #333;
            font-size: clamp(24px, 6vw, 36px);
            font-weight: bold;
            cursor: grab;
            user-select: none;
            transition: all 0.3s ease;
            touch-action: none;
            text-align: center;
            padding: 30px;
            box-shadow: 0 12px 35px rgba(102, 126, 234, 0.3);
        }

        .game-card.dragging {
            cursor: grabbing;
        }

        /* Фоновые подсказки для свайпов */
        .swipe-background {
            position: absolute;
            top: 60px;
            left: 0;
            right: 0;
            bottom: 120px;
            display: flex;
            pointer-events: none;
        }

        .swipe-bg-left, .swipe-bg-right {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 48px;
            opacity: 0.1;
            transition: opacity 0.3s ease;
        }

        .swipe-bg-left {
            color: #ff6b6b;
            background: linear-gradient(to right, rgba(255,107,107,0.1), transparent);
        }

        .swipe-bg-right {
            color: #51cf66;
            background: linear-gradient(to left, rgba(81,207,102,0.1), transparent);
        }

        .swipe-bg-left.active, .swipe-bg-right.active {
            opacity: 0.4;
            animation: swipePulse 0.5s ease-in-out;
        }

        @keyframes swipePulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        /* Визуальные подсказки внизу */
        .swipe-hints {
            display: flex;
            justify-content: space-between;
            width: 100%;
            max-width: 400px;
            margin-top: 30px;
        }

        .swipe-hint {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 15px 20px;
            border-radius: 15px;
            font-size: 16px;
            font-weight: 600;
            color: white;
            animation: hintPulse 3s ease-in-out infinite;
        }

        .swipe-hint.left {
            background: linear-gradient(135deg, #ff6b6b, #ff5252);
        }

        .swipe-hint.right {
            background: linear-gradient(135deg, #51cf66, #4caf50);
        }

        @keyframes hintPulse {
            0%, 100% { opacity: 0.8; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.05); }
        }

        .swipe-indicators {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            border-radius: 21px;
            overflow: hidden;
        }

        .swipe-indicator {
            position: absolute;
            width: 100%;
            height: 100%;
            opacity: 0;
            transition: opacity 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 64px;
            font-weight: bold;
        }

        .swipe-indicator.left {
            background: linear-gradient(135deg, rgba(255,107,107,0.4), rgba(255,82,82,0.4));
            color: #ff3030;
        }

        .swipe-indicator.right {
            background: linear-gradient(135deg, rgba(81,207,102,0.4), rgba(76,175,80,0.4));
            color: #2e7d32;
        }

        .swipe-indicator.active {
            opacity: 1;
        }

        /* Таймер внизу экрана */
        .game-timer {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: min(200px, 50vw);
            height: 80px;
            background: rgba(255,255,255,0.95);
            border-radius: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: clamp(32px, 8vw, 48px);
            font-weight: bold;
            color: #667eea;
            box-shadow: 0 8px 25px rgba(0,0,0,0.25);
            z-index: 100;
            border: 3px solid #667eea;
        }

        .game-timer.warning {
            background: linear-gradient(135deg, rgba(255,193,7,0.95), rgba(255,152,0,0.95));
            color: #d32f2f;
            animation: timerPulse 1s infinite;
            border-color: #d32f2f;
        }

        @keyframes timerPulse {
            0%, 100% { transform: translateX(-50%) scale(1); box-shadow: 0 8px 25px rgba(0,0,0,0.25); }
            50% { transform: translateX(-50%) scale(1.1); box-shadow: 0 12px 35px rgba(255,0,0,0.4); }
        }

        .results-list {
            margin: 20px 0;
            max-height: 40vh;
            overflow-y: auto;
        }

        .word-result {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            margin: 8px 0;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            touch-action: manipulation;
        }

        .word-result.correct {
            background: #4caf50;
            color: white;
        }

        .word-result.incorrect {
            background: #f44336;
            color: white;
        }

        .word-result:active {
            transform: scale(0.98);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin: 20px 0;
        }

        .stat-card {
            padding: 20px;
            background: #f7f7f7;
            border-radius: 15px;
            text-align: center;
        }

        .stat-value {
            font-size: clamp(28px, 7vw, 36px);
            font-weight: bold;
            color: #667eea;
        }

        .stat-label {
            font-size: clamp(12px, 3vw, 14px);
            color: #666;
            margin-top: 5px;
        }

        /* Праздничное окно победы */
        .victory-page {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .victory-page::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: 
                radial-gradient(circle at 20% 20%, rgba(255,215,0,0.3) 0%, transparent 50%),
                radial-gradient(circle at 80% 40%, rgba(255,192,203,0.2) 0%, transparent 50%),
                radial-gradient(circle at 40% 80%, rgba(173,216,230,0.2) 0%, transparent 50%);
            animation: sparkle 4s ease-in-out infinite;
        }

        @keyframes sparkle {
            0%, 100% { opacity: 0.8; }
            50% { opacity: 1; }
        }

        .victory-content {
            position: relative;
            z-index: 1;
        }

        .victory-title {
            font-size: clamp(32px, 8vw, 48px);
            margin-bottom: 20px;
            animation: victoryPulse 2s ease-in-out infinite;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .victory-winner {
            font-size: clamp(28px, 7vw, 40px);
            margin-bottom: 30px;
            color: #ffd700;
            text-shadow: 
                0 0 10px rgba(255,215,0,0.8),
                0 0 20px rgba(255,215,0,0.6),
                2px 2px 4px rgba(0,0,0,0.3);
            animation: winnerGlow 3s ease-in-out infinite;
        }

        @keyframes victoryPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        @keyframes winnerGlow {
            0%, 100% { 
                text-shadow: 
                    0 0 10px rgba(255,215,0,0.8),
                    0 0 20px rgba(255,215,0,0.6),
                    2px 2px 4px rgba(0,0,0,0.3);
            }
            50% { 
                text-shadow: 
                    0 0 20px rgba(255,215,0,1),
                    0 0 30px rgba(255,215,0,0.8),
                    0 0 40px rgba(255,215,0,0.6),
                    2px 2px 4px rgba(0,0,0,0.3);
            }
        }

        .victory-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin: 30px 0;
        }

        .victory-stat {
            background: rgba(255,255,255,0.15);
            padding: 25px;
            border-radius: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
        }

        .victory-stat-value {
            font-size: clamp(32px, 8vw, 44px);
            font-weight: bold;
            color: #ffd700;
            margin-bottom: 8px;
            text-shadow: 0 0 10px rgba(255,215,0,0.5);
        }

        .victory-stat-label {
            font-size: clamp(14px, 3vw, 16px);
            opacity: 0.9;
        }

        .qr-code {
            width: min(200px, 60vw);
            height: min(200px, 60vw);
            margin: 30px auto;
            background: rgba(255,255,255,0.95);
            color: #333;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 20px;
            font-size: clamp(14px, 3vw, 16px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
            border: 3px solid #ffd700;
        }

        .victory-button {
            background: rgba(255,255,255,0.2);
            border: 2px solid rgba(255,255,255,0.3);
            color: white;
            margin-top: 20px;
            backdrop-filter: blur(10px);
        }

        .victory-button:hover {
            background: rgba(255,255,255,0.3);
            border-color: rgba(255,255,255,0.5);
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 20px;
            max-width: 400px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-content h3 {
            margin-bottom: 20px;
            color: #667eea;
        }

        .modal-content input {
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
        }

        .modal-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .modal-buttons button {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            cursor: pointer;
            touch-action: manipulation;
        }

        .modal-buttons .save {
            background: #667eea;
            color: white;
        }

        .modal-buttons .delete {
            background: #f44336;
            color: white;
        }

        .modal-buttons .cancel {
            background: #e0e0e0;
        }

        .back-button {
            display: inline-flex;
            align-items: center;
            margin-bottom: 20px;
            padding: 10px 20px;
            background: #e0e0e0;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            touch-action: manipulation;
            font-size: clamp(14px, 3vw, 16px);
        }

        .back-button:hover {
            background: #d0d0d0;
        }

        /* Упрощенные настройки звука */
        .sound-settings {
            margin: 20px 0;
        }

        .volume-control {
            display: flex;
            align-items: center;
            gap: 15px;
            margin: 20px 0;
            background: #f8f9fa;
            padding: 20px;
            border-radius: 15px;
        }

        .volume-control label {
            min-width: 140px;
            font-size: clamp(14px, 3vw, 16px);
            font-weight: 600;
            color: #667eea;
        }

        .volume-control input[type="range"] {
            flex: 1;
            height: 8px;
            border-radius: 4px;
            background: #ddd;
            outline: none;
            -webkit-appearance: none;
        }

        .volume-control input[type="range"]::-webkit-slider-thumb {
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
        }

        .volume-control .volume-value {
            min-width: 50px;
            text-align: right;
            font-weight: bold;
            color: #667eea;
            font-size: 16px;
        }

        /* О приложении в главном меню */
        .main-menu-about {
            margin-top: 20px;
            padding-top: 20px;
            text-align: center;
            color: #666;
            font-size: clamp(12px, 3vw, 14px);
            line-height: 1.6;
        }

        .main-menu-about h3 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: clamp(16px, 4vw, 18px);
        }

        .main-menu-about p {
            margin-bottom: 10px;
        }

        /* Предупреждение о выборе тем */
        .theme-warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 10px;
            padding: 15px;
            margin: 20px 0;
            text-align: center;
            color: #856404;
            font-size: 14px;
            display: none;
        }

        .theme-warning.show {
            display: block;
        }

        /* Адаптивность */
        @media (max-width: 480px) {
            .container {
                padding: 5px;
            }
            
            .page {
                padding: 15px;
                border-radius: 10px;
                min-height: calc(100vh - 10px);
            }
            
            .category-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
            }
            
            .category-btn {
                padding: 15px 10px;
                min-height: 80px;
            }
            
            .game-card {
                width: 90vw;
                height: 25vh;
            }

            .sound-toggle-main, .control-btn {
                width: 40px;
                height: 40px;
                font-size: 16px;
            }

            .difficulty-selector {
                gap: 10px;
                padding: 20px 15px;
            }

            .difficulty-btn {
                width: 40px;
                height: 40px;
                font-size: 20px;
            }

            .difficulty-display {
                min-width: 120px;
                padding: 15px;
            }

            .setting-control {
                gap: 15px;
            }

            .setting-btn {
                width: 40px;
                height: 40px;
                font-size: 18px;
            }

            .setting-value {
                min-width: 60px;
                font-size: clamp(20px, 5vw, 24px);
                padding: 8px 15px;
            }

            .loader-progress {
                width: 250px;
                height: 8px;
            }

            .loader-logo {
                font-size: 36px;
                margin-bottom: 30px;
            }

            .bottom-menu {
                gap: 15px;
                padding: 15px;
            }

            .bottom-menu-item {
                min-width: 60px;
                padding: 12px;
            }

            .bottom-menu-item .icon {
                font-size: 20px;
            }

            .bottom-menu-item .label {
                font-size: 11px;
            }
        }

        @media (max-height: 600px) {
            .game-area {
                height: 30vh;
            }
            
            .game-card {
                height: 20vh;
            }
        }
    </style>
</head>
<body>
    <!-- Обновленная кнопка звука с выпадающим меню -->
    <div class="sound-control" id="soundControl">
        <button class="sound-toggle-main" id="soundToggleMain" onclick="toggleSoundDropdown()">🔊</button>
        <div class="sound-dropdown" id="soundDropdown">
            <button class="sound-dropdown-item" onclick="toggleGlobalSound()">
                <span class="icon" id="soundStatusIcon">🔊</span>
                <span id="soundStatusText">Звук включен</span>
            </button>
            <button class="sound-dropdown-item" onclick="showPage('soundSettings'); toggleSoundDropdown();">
                <span class="icon">⚙️</span>
                <span>Настройки</span>
            </button>
        </div>
    </div>

    <!-- Обновленный лоадер -->
    <div id="loader" class="loader">
        <div class="loader-logo">🎯 Alias Game</div>
        <div class="loader-progress">
            <div class="loader-progress-bar"></div>
        </div>
        <div class="loader-text">Загружается игра...</div>
    </div>

    <div class="container">
        <!-- Главное меню -->
        <div id="mainMenu" class="page">
            <h1>Alias Game</h1>
            <button class="menu-button" onclick="startNewGame()">🎮 Новая игра</button>
            <button class="menu-button" id="continueBtn" disabled>⏯️ Продолжить игру</button>
            <button class="menu-button" onclick="showPage('rules')">📖 Правила</button>
            
            <!-- Новое горизонтальное меню внизу -->
            <div class="bottom-menu">
                <button class="bottom-menu-item" onclick="showPage('dispace')" title="DiSpace - цифровая экосистема">
                    <div class="icon">🚀</div>
                    <div class="label">DiSpace</div>
                </button>
                <button class="bottom-menu-item" onclick="showPage('ratings')" title="Рейтинги игроков">
                    <div class="icon">🏆</div>
                    <div class="label">Рейтинги</div>
                </button>
                <button class="bottom-menu-item" onclick="showPage('partnerTasks')" title="Задания от партнеров">
                    <div class="icon">🎯</div>
                    <div class="label">Задания</div>
                </button>
                <button class="bottom-menu-item" onclick="showPage('rewards')" title="Мои награды и достижения">
                    <div class="icon">🎁</div>
                    <div class="label">Награды</div>
                </button>
            </div>
            
            <!-- О приложении внизу -->
            <div class="main-menu-about">
                <h3>О приложении</h3>
                <p>Alias Game - увлекательная командная игра, где нужно объяснять слова, не называя их напрямую.</p>
                <p>Играйте с друзьями, зарабатывайте награды и участвуйте в турнирах!</p>
                <p><strong>Версия:</strong> 2.1.0</p>
                <p><strong>Разработчик:</strong> © 2024 DiSpace</p>
            </div>
        </div>

        <!-- Настройка команд -->
        <div id="teamSetup" class="page">
            <div class="back-button" onclick="showPage('mainMenu')">← Назад</div>
            <h2>Настройка команд</h2>
            <div id="teamList" class="team-list"></div>
            <div class="add-team-btn" onclick="addTeam()">+</div>
            <button class="menu-button" onclick="showPage('categorySelect')">Далее →</button>
        </div>

        <!-- Выбор категорий -->
        <div id="categorySelect" class="page">
            <div class="back-button" onclick="showPage('teamSetup')">← Назад</div>
            <h2>Выбор категорий</h2>
            <div class="theme-warning" id="themeWarning">
                ⚠️ Выберите хотя бы одну тему для игры!
            </div>
            
            <h3>Сложность</h3>
            <div class="difficulty-selector">
                <button class="difficulty-btn" onclick="adjustDifficulty(-1)">−</button>
                <div class="difficulty-display">
                    <div class="difficulty-level" id="difficultyLevel">🟢</div>
                    <div class="difficulty-name" id="difficultyName">Легкий</div>
                    <div class="difficulty-desc" id="difficultyDesc">Простые слова</div>
                </div>
                <button class="difficulty-btn" onclick="adjustDifficulty(1)">+</button>
            </div>
            
            <h3>Темы</h3>
            <div class="category-grid">
                <button class="category-btn" data-type="theme" data-value="cities">
                    <div class="category-icon">🏙️</div>
                    <div>Города</div>
                    <div class="category-tooltip">Города мира</div>
                </button>
                <button class="category-btn" data-type="theme" data-value="capitals">
                    <div class="category-icon">🏛️</div>
                    <div>Столицы</div>
                    <div class="category-tooltip">Столицы стран</div>
                </button>
                <button class="category-btn" data-type="theme" data-value="general">
                    <div class="category-icon">📚</div>
                    <div>Общие слова</div>
                    <div class="category-tooltip">Разные темы</div>
                </button>
                <button class="category-btn" data-type="theme" data-value="harry_potter">
                    <div class="category-icon">⚡</div>
                    <div>Гарри Поттер</div>
                    <div class="category-tooltip">Мир магии</div>
                </button>
                <button class="category-btn" data-type="theme" data-value="lotr">
                    <div class="category-icon">💍</div>
                    <div>Властелин колец</div>
                    <div class="category-tooltip">Средиземье</div>
                </button>
                <button class="category-btn" data-type="theme" data-value="celebrities">
                    <div class="category-icon">⭐</div>
                    <div>Знаменитости</div>
                    <div class="category-tooltip">Известные люди</div>
                </button>
                <button class="category-btn" data-type="theme" data-value="tech">
                    <div class="category-icon">💻</div>
                    <div>Технологии</div>
                    <div class="category-tooltip">IT и гаджеты</div>
                </button>
                <button class="category-btn" data-type="theme" data-value="science">
                    <div class="category-icon">🔬</div>
                    <div>Наука</div>
                    <div class="category-tooltip">Научные термины</div>
                </button>
            </div>
            <button class="menu-button" onclick="proceedToGameSettings()">Далее →</button>
        </div>

        <!-- Настройки игры -->
        <div id="gameSettings" class="page">
            <div class="back-button" onclick="showPage('categorySelect')">← Назад</div>
            <h2>Настройки игры</h2>
            
            <div class="settings-group">
                <label>Время раунда</label>
                <div class="setting-control">
                    <button class="setting-btn" onclick="adjustSetting('roundTime', -10)">−</button>
                    <div class="setting-value" id="roundTimeValue">60 сек</div>
                    <button class="setting-btn" onclick="adjustSetting('roundTime', 10)">+</button>
                </div>
            </div>

            <div class="settings-group">
                <label>Минимальное количество очков для победы</label>
                <div class="setting-control">
                    <button class="setting-btn" onclick="adjustSetting('winScore', -5)">−</button>
                    <div class="setting-value" id="winScoreValue">30</div>
                    <button class="setting-btn" onclick="adjustSetting('winScore', 5)">+</button>
                </div>
            </div>

            <div class="settings-group">
                <label>Ставка (монеты)</label>
                <input type="range" class="bet-slider" id="betSlider" min="0" max="100" value="0" oninput="updateBetValue(this.value)">
                <div class="bet-value" id="betValue">0 монет</div>
            </div>

            <div class="checkbox-group">
                <input type="checkbox" id="skipPenalty">
                <label for="skipPenalty">Штраф за пропуск слова (-1 очко)</label>
            </div>

            <button class="menu-button" onclick="startGame()">🎮 Начать игру</button>
        </div>

        <!-- Игровой экран -->
        <div id="gameScreen" class="page" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 0;">
            <!-- Фоновые подсказки -->
            <div class="swipe-background">
                <div class="swipe-bg-left" id="swipeBgLeft">❌ ПРОПУСТИТЬ</div>
                <div class="swipe-bg-right" id="swipeBgRight">ОТГАДАНО ✅</div>
            </div>
            
            <!-- Фиксированные кнопки управления -->
            <div class="game-controls">
                <button class="control-btn" id="gameSoundToggle" onclick="toggleGameSound()">🔊</button>
                <button class="control-btn" onclick="pauseGame()">⏸️</button>
                <button class="control-btn" onclick="exitToMenu()">🏠</button>
            </div>
            
            <div class="game-header">
                <div class="game-score" id="headerScore">Очки: 0</div>
            </div>
            
            <div class="current-team" id="currentTeam" style="text-align: center; font-size: 20px; color: white; margin: 20px 0;">Команда 1</div>
            
            <div class="game-area">
                <div class="game-card" id="gameCard">
                    <div class="swipe-indicators">
                        <div class="swipe-indicator left">❌</div>
                        <div class="swipe-indicator right">✅</div>
                    </div>
                    <span id="cardText">Готов?</span>
                </div>
                
                <!-- Визуальные подсказки -->
                <div class="swipe-hints">
                    <div class="swipe-hint left">
                        <span>←</span>
                        <span>Пропустить</span>
                    </div>
                    <div class="swipe-hint right">
                        <span>Отгадано</span>
                        <span>→</span>
                    </div>
                </div>
            </div>

            <div class="game-timer" id="gameTimer">60</div>
        </div>

        <!-- Промежуточные результаты -->
        <div id="roundResults" class="page">
            <h2>Результаты раунда</h2>
            <div id="resultsList" class="results-list"></div>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="correctCount">0</div>
                    <div class="stat-label">Угадано</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="incorrectCount">0</div>
                    <div class="stat-label">Пропущено</div>
                </div>
            </div>
            <button class="menu-button" onclick="nextRound()">Далее →</button>
        </div>

        <!-- Праздничные финальные результаты -->
        <div id="finalResults" class="page victory-page">
            <div class="victory-content">
                <h2 class="victory-title">🎉 Поздравляем! 🎉</h2>
                <h1 class="victory-winner" id="winnerName">Победитель</h1>
                <div class="victory-stats">
                    <div class="victory-stat">
                        <div class="victory-stat-value" id="finalScore">0</div>
                        <div class="victory-stat-label">Очков набрано</div>
                    </div>
                    <div class="victory-stat">
                        <div class="victory-stat-value" id="prizeAmount">0</div>
                        <div class="victory-stat-label">Призовой фонд</div>
                    </div>
                </div>
                <div class="qr-code">
                    <span>🎁 QR-код награды 🎁</span>
                </div>
                <button class="menu-button victory-button" onclick="showPage('mainMenu')">🏠 В главное меню</button>
            </div>
        </div>

        <!-- Упрощенные настройки звука -->
        <div id="soundSettings" class="page">
            <div class="back-button" onclick="showPage('mainMenu')">← Назад</div>
            <h2>Настройки звука</h2>
            <div class="sound-settings">
                <div class="volume-control">
                    <label>Звуки кнопок:</label>
                    <input type="range" id="buttonVolume" min="0" max="100" value="50">
                    <span class="volume-value" id="buttonVolumeValue">50%</span>
                </div>
                <div class="volume-control">
                    <label>Звуки таймера:</label>
                    <input type="range" id="timerVolume" min="0" max="100" value="80">
                    <span class="volume-value" id="timerVolumeValue">80%</span>
                </div>
            </div>
            <button class="menu-button" onclick="testSounds()">🔊 Тест звуков</button>
        </div>

        <!-- DiSpace -->
        <div id="dispace" class="page">
            <div class="back-button" onclick="showPage('mainMenu')">← Назад</div>
            <h2>DiSpace</h2>
            <p>DiSpace - цифровая экосистема для бизнеса и развлечений. Объединяем лучшие сервисы в единое пространство:</p>
            <ul style="margin: 20px; line-height: 2; padding-left: 20px;">
                <li>Digital Bar</li>
                <li>Game Bar</li>
                <li>Digital Hotel</li>
                <li>Digital Cafe</li>
                <li>Digital Trip</li>
                <li>Digital Music</li>
                <li>Digital Sharing</li>
                <li>Digital Health</li>
                <li>Digital Delivery</li>
            </ul>
        </div>

        <!-- Рейтинги -->
        <div id="ratings" class="page">
            <div class="back-button" onclick="showPage('mainMenu')">← Назад</div>
            <h2>Рейтинги</h2>
            <div id="ratingsList">
                <p>Рейтинги игроков будут отображаться здесь после первых игр.</p>
            </div>
        </div>

        <!-- Задания от партнеров -->
        <div id="partnerTasks" class="page">
            <div class="back-button" onclick="showPage('mainMenu')">← Назад</div>
            <h2>Задания от партнеров</h2>
            <p>Эксклюзивные сценарии игры от наших партнеров появятся здесь скоро!</p>
        </div>

        <!-- Награды -->
        <div id="rewards" class="page">
            <div class="back-button" onclick="showPage('mainMenu')">← Назад</div>
            <h2>Мои награды</h2>
            <p>Здесь будут отображаться ваши достижения и награды.</p>
        </div>

        <!-- Правила -->
        <div id="rules" class="page">
            <div class="back-button" onclick="showPage('mainMenu')">← Назад</div>
            <h2>Правила игры</h2>
            <p><strong>Цель игры:</strong> Объяснить как можно больше слов своей команде за отведенное время.</p>
            <p style="margin: 20px 0;"><strong>Как играть:</strong></p>
            <ol style="margin: 20px; line-height: 2; padding-left: 20px;">
                <li>Разделитесь на команды</li>
                <li>Выберите категории слов и сложность</li>
                <li>Объясняйте слова, не называя их и однокоренные слова</li>
                <li>Свайп вправо - слово угадано (+1 очко)</li>
                <li>Свайп влево - пропустить слово</li>
                <li>Побеждает команда, набравшая больше всех очков, но не менее установленного минимума</li>
            </ol>
        </div>

        <!-- Модальное окно для редактирования команды -->
        <div id="teamModal" class="modal">
            <div class="modal-content">
                <h3>Редактировать команду</h3>
                <input type="text" id="teamNameInput" placeholder="Название команды">
                <div class="modal-buttons">
                    <button class="save" onclick="saveTeamName()">Сохранить</button>
                    <button class="delete" onclick="deleteTeam()">Удалить</button>
                    <button class="cancel" onclick="closeModal()">Отмена</button>
                </div>
            </div>
        </div>

        <!-- Модальное окно паузы -->
        <div id="pauseModal" class="modal">
            <div class="modal-content">
                <h3>Игра приостановлена</h3>
                <button class="menu-button" onclick="resumeGame()">▶️ Продолжить</button>
                <button class="menu-button" onclick="exitToMenuConfirm()">🏠 В главное меню</button>
            </div>
        </div>
    </div>

    <script>
        // Глобальные переменные
        let teams = [];
        let currentTeamIndex = 0;
        let currentWord = '';
        let timer = null;
        let timeLeft = 60;
        let gameWords = [];
        let usedWords = new Set(); // Отслеживаем использованные слова
        let roundWords = { correct: [], incorrect: [] };
        let gameSettings = {
            roundTime: 60,
            winScore: 30,
            skipPenalty: false,
            betAmount: 0,
            difficulty: 0 // 0=easy, 1=medium, 2=hard, 3=extreme
        };
        let currentEditingTeam = null;
        let isDragging = false;
        let startX = 0;
        let currentX = 0;
        let isPaused = false;
        let gameEnded = false;
        let soundSettings = {
            buttons: 50,
            timer: 80,
            enabled: true
        };

        // Веселые названия команд
        const randomTeamNames = [
            'Квантовые Мечтатели', 'Цифровые Гении', 'Неоновые Ниндзя', 'Космические Коты',
            'Пиксельные Пираты', 'Виртуальные Викинги', 'Электронные Эльфы', 'Кибер Кракены',
            'Битовые Бойцы', 'Алгоритмические Акулы', 'Хакерские Хамелеоны', 'Дата Драконы',
            'Код Командоры', 'Файловые Феи', 'Интернет Исследователи', 'Логические Ламы',
            'Процессорные Панды', 'Серверные Совы', 'Технологичные Тигры', 'Умные Ёжики',
            'Байтовые Бобры', 'Гига Гепарды', 'Мега Медведи', 'Тера Туканы',
            'Смарт Сфинксы', 'Диджитал Дельфины', 'Нано Носороги', 'Микро Мангусты',
            'Веб Волки', 'Чат Черепахи', 'Блог Барсуки', 'Сайт Слоны',
            'Апп Аисты', 'Код Кенгуру', 'Скрипт Скорпионы', 'База Бегемоты'
        ];

        // Словари сложности
        const difficultyLevels = [
            { level: '🟢', name: 'Легкий', desc: 'Простые слова', value: 'easy' },
            { level: '🟡', name: 'Средний', desc: 'Обычная сложность', value: 'medium' },
            { level: '🟠', name: 'Сложный', desc: 'Сложные слова', value: 'hard' },
            { level: '🔴', name: 'Экстрим', desc: 'Очень сложно!', value: 'extreme' }
        ];

        // Расширенные словари слов
        const wordDictionaries = {
            easy: {
                general: ['стол', 'стул', 'дом', 'кот', 'собака', 'дерево', 'солнце', 'луна', 'вода', 'огонь', 'книга', 'ручка', 'телефон', 'компьютер', 'машина', 'автобус', 'поезд', 'самолет', 'корабль', 'велосипед', 'часы', 'зеркало', 'окно', 'дверь', 'стена', 'пол', 'потолок', 'крыша', 'лестница', 'лифт', 'магазин', 'школа', 'больница', 'театр', 'кино', 'парк', 'река', 'озеро', 'море', 'гора', 'лес', 'поле', 'сад', 'цветок', 'трава', 'листья', 'ветка', 'корень', 'камень'],
                cities: ['Москва', 'Санкт-Петербург', 'Новосибирск', 'Екатеринбург', 'Казань', 'Нижний Новгород', 'Челябинск', 'Самара', 'Омск', 'Ростов-на-Дону', 'Уфа', 'Красноярск', 'Воронеж', 'Пермь', 'Волгоград', 'Краснодар', 'Саратов', 'Тюмень', 'Тольятти', 'Ижевск'],
                capitals: ['Москва', 'Вашингтон', 'Лондон', 'Париж', 'Берлин', 'Рим', 'Мадрид', 'Лиссабон', 'Амстердам', 'Брюссель', 'Вена', 'Берн', 'Стокгольм', 'Осло', 'Копенгаген', 'Хельсинки', 'Варшава', 'Прага', 'Братислава', 'Будапешт'],
                tech: ['компьютер', 'телефон', 'смартфон', 'планшет', 'ноутбук', 'интернет', 'сайт', 'приложение', 'программа', 'код', 'клавиатура', 'мышь', 'монитор', 'экран', 'принтер', 'сканер', 'камера', 'микрофон', 'колонки', 'наушники']
            },
            medium: {
                general: ['абстракция', 'амбиция', 'анализ', 'аргумент', 'атмосфера', 'баланс', 'барьер', 'вдохновение', 'взаимодействие', 'влияние', 'воображение', 'восприятие', 'гармония', 'гипотеза', 'дилемма', 'дисциплина', 'достижение', 'единство', 'жертва', 'забота'],
                celebrities: ['Пушкин', 'Толстой', 'Достоевский', 'Чехов', 'Гоголь', 'Лермонтов', 'Тургенев', 'Некрасов', 'Крылов', 'Эйнштейн', 'Ньютон', 'Дарвин', 'Галилей', 'Коперник', 'Кеплер', 'Менделеев', 'Ломоносов', 'Павлов', 'Шекспир', 'Данте'],
                science: ['гравитация', 'эволюция', 'фотосинтез', 'атом', 'молекула', 'энергия', 'электричество', 'магнетизм', 'радиация', 'квант', 'фотон', 'электрон', 'протон', 'нейтрон', 'ядро', 'изотоп', 'элемент', 'соединение', 'реакция', 'катализ']
            },
            hard: {
                general: ['парадокс', 'абстракция', 'концепция', 'философия', 'метафора', 'аллегория', 'символизм', 'метонимия', 'синекдоха', 'оксюморон', 'антитеза', 'гипербола', 'литота', 'ирония', 'сарказм', 'эвфемизм'],
                harry_potter: ['Хогвартс', 'квиддич', 'патронус', 'крестраж', 'дементор', 'магл', 'волшебная палочка', 'Гриффиндор', 'Слизерин', 'Когтевран', 'Пуффендуй', 'Волдеморт', 'Дамблдор', 'Снейп', 'МакГонагалл', 'Хагрид'],
                lotr: ['Средиземье', 'хоббит', 'Гондор', 'Мордор', 'эльф', 'орк', 'Шир', 'Изенгард', 'Роhan', 'Минас Тирит', 'Минас Моргул', 'Барад-дур', 'Ортханк', 'Эдорас', 'Хельмова Падь', 'Фангорн']
            },
            extreme: {
                general: ['экзистенциализм', 'феноменология', 'герменевтика', 'эпистемология', 'онтология', 'гносеология', 'аксиология', 'дискурс', 'парадигма', 'синергетика'],
                harry_potter: ['Авада Кедавра', 'Экспеллиармус', 'Экспекто Патронум', 'Турнир Трех Волшебников', 'Кубок Огня', 'Золотой Снитч', 'Квафл', 'Бладжер', 'Мародерская карта', 'Тайная комната'],
                lotr: ['Эльронд', 'Галадриэль', 'Саурон', 'Сарумон', 'Леголас', 'Гимли', 'Боромир', 'Арагорн', 'Фродо', 'Сэм']
            }
        };

        // Звуковые эффекты
        const sounds = {
            button: () => playTone(220, 100, soundSettings.buttons),
            correct: () => playTone(440, 200, 60),
            incorrect: () => playTone(165, 300, 60),
            timer: () => playTone(880, 100, soundSettings.timer),
            roundEnd: () => playTone(330, 500, 60)
        };

        // Функция создания тона
        function playTone(frequency, duration, volume = 50) {
            if (!soundSettings.enabled) return;
            
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.value = frequency;
                oscillator.type = 'sine';
                
                const finalVolume = (volume / 100) * 0.1;
                
                gainNode.gain.setValueAtTime(0, audioContext.currentTime);
                gainNode.gain.linearRampToValueAtTime(finalVolume, audioContext.currentTime + 0.01);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + duration / 1000);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + duration / 1000);
            } catch (e) {
                console.warn('Не удалось воспроизвести звук:', e);
            }
        }

        // Инициализация
        function init() {
            // Показываем лоадер
            setTimeout(() => {
                document.getElementById('loader').style.display = 'none';
                document.getElementById('mainMenu').classList.add('active');
            }, 3000);

            // Загружаем настройки звука
            loadSoundSettings();

            // Добавляем две команды по умолчанию с рандомными названиями
            const team1Name = randomTeamNames[Math.floor(Math.random() * randomTeamNames.length)];
            let team2Name;
            do {
                team2Name = randomTeamNames[Math.floor(Math.random() * randomTeamNames.length)];
            } while (team2Name === team1Name);

            teams = [
                { name: team1Name, score: 0 },
                { name: team2Name, score: 0 }
            ];
            renderTeams();

            // Добавляем обработчики для категорий
            document.querySelectorAll('.category-btn').forEach(btn => {
                btn.addEventListener('click', toggleCategory);
            });

            // Настройка свайпов для игровой карточки
            setupCardSwipe();

            // Настройка звуковых ползунков
            setupSoundControls();

            // Добавляем звуки кнопок
            document.querySelectorAll('.menu-button, .back-button, .control-btn').forEach(btn => {
                btn.addEventListener('click', () => playSound('button'));
            });

            // Обновляем кнопки звука
            updateSoundButtons();

            // Инициализируем настройки игры
            initGameSettings();
            initDifficultySelector();

            // Закрываем выпадающее меню при клике вне его
            document.addEventListener('click', (e) => {
                if (!e.target.closest('.sound-control')) {
                    document.getElementById('soundDropdown').classList.remove('show');
                }
            });
        }

        // Функции управления выпадающим меню звука
        function toggleSoundDropdown() {
            const dropdown = document.getElementById('soundDropdown');
            dropdown.classList.toggle('show');
        }

        // Настройки звука
        function loadSoundSettings() {
            const saved = localStorage.getItem('aliasSound');
            if (saved) {
                soundSettings = {...soundSettings, ...JSON.parse(saved)};
                updateSoundUI();
            }
        }

        function saveSoundSettings() {
            localStorage.setItem('aliasSound', JSON.stringify(soundSettings));
            updateSoundButtons();
        }

        function setupSoundControls() {
            const controls = ['button', 'timer'];
            controls.forEach(type => {
                const slider = document.getElementById(`${type}Volume`);
                const value = document.getElementById(`${type}VolumeValue`);
                
                if (slider && value) {
                    const soundType = type === 'button' ? 'buttons' : type;
                    slider.value = soundSettings[soundType];
                    value.textContent = slider.value + '%';
                    
                    slider.addEventListener('input', (e) => {
                        const val = e.target.value;
                        soundSettings[soundType] = parseInt(val);
                        value.textContent = val + '%';
                        saveSoundSettings();
                    });
                }
            });
        }

        function updateSoundUI() {
            const controls = ['button', 'timer'];
            controls.forEach(type => {
                const slider = document.getElementById(`${type}Volume`);
                const value = document.getElementById(`${type}VolumeValue`);
                
                if (slider && value) {
                    const soundType = type === 'button' ? 'buttons' : type;
                    slider.value = soundSettings[soundType];
                    value.textContent = soundSettings[soundType] + '%';
                }
            });
        }

        function playSound(type) {
            if (sounds[type]) {
                sounds[type]();
            }
        }

        function toggleGlobalSound() {
            soundSettings.enabled = !soundSettings.enabled;
            saveSoundSettings();
            updateSoundButtons();
            playSound('button');
            toggleSoundDropdown();
        }

        function toggleGameSound() {
            soundSettings.enabled = !soundSettings.enabled;
            saveSoundSettings();
            updateSoundButtons();
            playSound('button');
        }

        function updateSoundButtons() {
            // Обновляем главную кнопку
            const mainBtn = document.getElementById('soundToggleMain');
            if (mainBtn) {
                mainBtn.textContent = soundSettings.enabled ? '🔊' : '🔇';
                mainBtn.classList.toggle('muted', !soundSettings.enabled);
            }

            // Обновляем игровую кнопку
            const gameBtn = document.getElementById('gameSoundToggle');
            if (gameBtn) {
                gameBtn.textContent = soundSettings.enabled ? '🔊' : '🔇';
                gameBtn.classList.toggle('muted', !soundSettings.enabled);
            }

            // Обновляем текст в выпадающем меню
            const statusIcon = document.getElementById('soundStatusIcon');
            const statusText = document.getElementById('soundStatusText');
            if (statusIcon && statusText) {
                statusIcon.textContent = soundSettings.enabled ? '🔊' : '🔇';
                statusText.textContent = soundSettings.enabled ? 'Звук включен' : 'Звук выключен';
            }
        }

        function testSounds() {
            setTimeout(() => playSound('button'), 100);
            setTimeout(() => playSound('correct'), 500);
            setTimeout(() => playSound('incorrect'), 1000);
            setTimeout(() => playSound('timer'), 1500);
            setTimeout(() => playSound('roundEnd'), 2000);
        }

        // Инициализация настроек игры
        function initGameSettings() {
            updateSettingDisplay('roundTime', gameSettings.roundTime + ' сек');
            updateSettingDisplay('winScore', gameSettings.winScore);
            updateBetValue(gameSettings.betAmount);
        }

        function initDifficultySelector() {
            updateDifficultyDisplay();
        }

        function updateDifficultyDisplay() {
            const currentDiff = difficultyLevels[gameSettings.difficulty];
            document.getElementById('difficultyLevel').textContent = currentDiff.level;
            document.getElementById('difficultyName').textContent = currentDiff.name;
            document.getElementById('difficultyDesc').textContent = currentDiff.desc;
        }

        function adjustDifficulty(delta) {
            playSound('button');
            gameSettings.difficulty = Math.max(0, Math.min(difficultyLevels.length - 1, gameSettings.difficulty + delta));
            updateDifficultyDisplay();
        }

        function updateSettingDisplay(setting, value) {
            document.getElementById(setting + 'Value').textContent = value;
        }

        function adjustSetting(setting, delta) {
            playSound('button');
            
            if (setting === 'roundTime') {
                gameSettings.roundTime = Math.max(30, Math.min(180, gameSettings.roundTime + delta));
                updateSettingDisplay('roundTime', gameSettings.roundTime + ' сек');
            } else if (setting === 'winScore') {
                gameSettings.winScore = Math.max(10, Math.min(100, gameSettings.winScore + delta));
                updateSettingDisplay('winScore', gameSettings.winScore);
            }
        }

        function updateBetValue(value) {
            gameSettings.betAmount = parseInt(value);
            document.getElementById('betValue').textContent = value + ' монет';
        }

        // Переключение между страницами
        function showPage(pageId) {
            playSound('button');
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            document.getElementById(pageId).classList.add('active');
            
            // Скрываем/показываем звуковые элементы управления
            const soundControl = document.getElementById('soundControl');
            if (pageId === 'gameScreen') {
                soundControl.style.display = 'none';
            } else {
                soundControl.style.display = 'block';
                // Закрываем выпадающее меню
                document.getElementById('soundDropdown').classList.remove('show');
            }
        }

        // Начать новую игру
        function startNewGame() {
            playSound('button');
            gameEnded = false;
            usedWords.clear(); // Сбрасываем использованные слова
            
            // Генерируем новые рандомные названия команд
            const team1Name = randomTeamNames[Math.floor(Math.random() * randomTeamNames.length)];
            let team2Name;
            do {
                team2Name = randomTeamNames[Math.floor(Math.random() * randomTeamNames.length)];
            } while (team2Name === team1Name);

            teams = [
                { name: team1Name, score: 0 },
                { name: team2Name, score: 0 }
            ];
            renderTeams();
            showPage('teamSetup');
        }

        // Управление командами
        function renderTeams() {
            const teamList = document.getElementById('teamList');
            teamList.innerHTML = '';
            
            teams.forEach((team, index) => {
                const teamItem = document.createElement('div');
                teamItem.className = 'team-item';
                teamItem.innerHTML = `
                    <span class="team-name">${team.name}</span>
                    <span class="team-score">${team.score}</span>
                `;
                teamItem.onclick = () => editTeam(index);
                teamList.appendChild(teamItem);
            });
        }

        function addTeam() {
            playSound('button');
            if (teams.length >= 10) {
                alert('Максимум 10 команд!');
                return;
            }
            
            // Выбираем название, которое еще не используется
            let randomName;
            do {
                randomName = randomTeamNames[Math.floor(Math.random() * randomTeamNames.length)];
            } while (teams.some(team => team.name === randomName));
            
            teams.push({ name: randomName, score: 0 });
            renderTeams();
        }

        function editTeam(index) {
            playSound('button');
            currentEditingTeam = index;
            document.getElementById('teamNameInput').value = teams[index].name;
            document.getElementById('teamModal').classList.add('active');
        }

        function saveTeamName() {
            playSound('button');
            const newName = document.getElementById('teamNameInput').value.trim();
            if (newName) {
                teams[currentEditingTeam].name = newName;
                renderTeams();
            }
            closeModal();
        }

        function deleteTeam() {
            playSound('button');
            if (teams.length > 2) {
                teams.splice(currentEditingTeam, 1);
                renderTeams();
            } else {
                alert('Минимум 2 команды!');
            }
            closeModal();
        }

        function closeModal() {
            playSound('button');
            document.querySelectorAll('.modal').forEach(modal => {
                modal.classList.remove('active');
            });
        }

        // Управление категориями
        function toggleCategory(e) {
            playSound('button');
            const btn = e.target.closest('.category-btn');
            btn.classList.toggle('selected');
            
            // Скрываем предупреждение если выбрана хотя бы одна тема
            const selectedThemes = document.querySelectorAll('[data-type="theme"].selected');
            const warning = document.getElementById('themeWarning');
            if (selectedThemes.length > 0) {
                warning.classList.remove('show');
            }
        }

        // Проверка выбора тем перед переходом к настройкам
        function proceedToGameSettings() {
            const selectedThemes = document.querySelectorAll('[data-type="theme"].selected');
            const warning = document.getElementById('themeWarning');
            
            if (selectedThemes.length === 0) {
                warning.classList.add('show');
                warning.scrollIntoView({ behavior: 'smooth', block: 'center' });
                return;
            }
            
            showPage('gameSettings');
        }

        // Начать игру
        function startGame() {
            playSound('button');
            
            // Получаем настройки из интерфейса
            gameSettings.skipPenalty = document.getElementById('skipPenalty').checked;
            gameSettings.betAmount = parseInt(document.getElementById('betSlider').value);

            // Подготавливаем слова
            prepareGameWords();
            
            // Сбрасываем счет
            teams.forEach(team => team.score = 0);
            currentTeamIndex = 0;
            gameEnded = false;
            usedWords.clear(); // Сбрасываем использованные слова
            
            // Показываем игровой экран
            showPage('gameScreen');
            prepareRound();
        }

        function prepareGameWords() {
            gameWords = [];
            
            // Получаем выбранную сложность
            const difficulty = difficultyLevels[gameSettings.difficulty].value;
            
            // Получаем выбранные темы
            const selectedThemes = Array.from(document.querySelectorAll('[data-type="theme"].selected'))
                .map(btn => btn.dataset.value);
            
            // Собираем слова из выбранных категорий
            selectedThemes.forEach(theme => {
                if (wordDictionaries[difficulty] && wordDictionaries[difficulty][theme]) {
                    gameWords.push(...wordDictionaries[difficulty][theme]);
                }
            });
            
            // Перемешиваем слова
            gameWords.sort(() => Math.random() - 0.5);
        }

        function prepareRound() {
            const currentTeam = teams[currentTeamIndex];
            document.getElementById('currentTeam').textContent = currentTeam.name;
            document.getElementById('headerScore').textContent = `Очки: ${currentTeam.score}`;
            document.getElementById('cardText').textContent = 'Готов?';
            
            roundWords = { correct: [], incorrect: [] };
            timeLeft = gameSettings.roundTime;
            updateTimer();
            
            // Ждем свайп для начала
            waitForReady();
        }

        function waitForReady() {
            const card = document.getElementById('gameCard');
            card.dataset.mode = 'ready';
        }

        function startRound() {
            playSound('button');
            
            // Обратный отсчет
            let countdown = 3;
            const card = document.getElementById('gameCard');
            card.dataset.mode = 'countdown';
            
            const countdownInterval = setInterval(() => {
                document.getElementById('cardText').textContent = countdown;
                countdown--;
                
                if (countdown < 0) {
                    clearInterval(countdownInterval);
                    card.dataset.mode = 'game';
                    showNextWord();
                    startTimer();
                }
            }, 1000);
        }

        function showNextWord() {
            // Фильтруем неиспользованные слова
            const availableWords = gameWords.filter(word => !usedWords.has(word));
            
            if (availableWords.length === 0) {
                // Если все слова использованы, сбрасываем использованные
                usedWords.clear();
                prepareGameWords(); // Перемешиваем заново
                return showNextWord();
            }
            
            // Берем случайное слово из доступных
            const randomIndex = Math.floor(Math.random() * availableWords.length);
            currentWord = availableWords[randomIndex];
            usedWords.add(currentWord); // Помечаем как использованное
            
            document.getElementById('cardText').textContent = currentWord;
        }

        function handleWordResult(isCorrect) {
            const currentTeam = teams[currentTeamIndex];
            
            if (isCorrect) {
                currentTeam.score++;
                roundWords.correct.push(currentWord);
                playSound('correct');
            } else {
                if (gameSettings.skipPenalty) {
                    currentTeam.score = Math.max(0, currentTeam.score - 1);
                }
                roundWords.incorrect.push(currentWord);
                playSound('incorrect');
            }
            
            document.getElementById('headerScore').textContent = `Очки: ${currentTeam.score}`;
            showNextWord();
        }

        function startTimer() {
            timer = setInterval(() => {
                timeLeft--;
                updateTimer();
                
                if (timeLeft <= 10 && timeLeft > 0) {
                    playSound('timer');
                    document.getElementById('gameTimer').classList.add('warning');
                }
                
                if (timeLeft <= 0) {
                    clearInterval(timer);
                    playSound('roundEnd');
                    endRound();
                }
            }, 1000);
        }

        function updateTimer() {
            document.getElementById('gameTimer').textContent = timeLeft;
        }

        function pauseGame() {
            playSound('button');
            if (timer) {
                clearInterval(timer);
                isPaused = true;
                document.getElementById('pauseModal').classList.add('active');
            }
        }

        function resumeGame() {
            playSound('button');
            isPaused = false;
            closeModal();
            if (timeLeft > 0 && !gameEnded) {
                startTimer();
            }
        }

        function exitToMenu() {
            playSound('button');
            document.getElementById('pauseModal').classList.add('active');
        }

        function exitToMenuConfirm() {
            playSound('button');
            clearInterval(timer);
            isPaused = false;
            gameEnded = true;
            closeModal();
            showPage('mainMenu');
        }

        function endRound() {
            clearInterval(timer);
            document.getElementById('gameTimer').classList.remove('warning');
            showRoundResults();
        }

        function showRoundResults() {
            showPage('roundResults');
            
            const resultsList = document.getElementById('resultsList');
            resultsList.innerHTML = '';
            
            // Показываем угаданные слова
            roundWords.correct.forEach((word, index) => {
                const wordDiv = document.createElement('div');
                wordDiv.className = 'word-result correct';
                wordDiv.innerHTML = `<span>${word}</span><span>+1</span>`;
                wordDiv.onclick = () => toggleWordResult(word, index, true);
                resultsList.appendChild(wordDiv);
            });
            
            // Показываем пропущенные слова
            roundWords.incorrect.forEach((word, index) => {
                const wordDiv = document.createElement('div');
                wordDiv.className = 'word-result incorrect';
                const penalty = gameSettings.skipPenalty ? '-1' : '0';
                wordDiv.innerHTML = `<span>${word}</span><span>${penalty}</span>`;
                wordDiv.onclick = () => toggleWordResult(word, index, false);
                resultsList.appendChild(wordDiv);
            });
            
            document.getElementById('correctCount').textContent = roundWords.correct.length;
            document.getElementById('incorrectCount').textContent = roundWords.incorrect.length;
        }

        function toggleWordResult(word, index, wasCorrect) {
            playSound('button');
            const currentTeam = teams[currentTeamIndex];
            
            if (wasCorrect) {
                // Перемещаем из правильных в неправильные
                roundWords.correct.splice(index, 1);
                roundWords.incorrect.push(word);
                currentTeam.score--;
                if (gameSettings.skipPenalty) {
                    currentTeam.score = Math.max(0, currentTeam.score - 1);
                }
            } else {
                // Перемещаем из неправильных в правильные
                roundWords.incorrect.splice(index, 1);
                roundWords.correct.push(word);
                currentTeam.score++;
                if (gameSettings.skipPenalty) {
                    currentTeam.score++;
                }
            }
            
            showRoundResults();
        }

        function nextRound() {
            playSound('button');
            
            // Переходим к следующей команде
            currentTeamIndex = (currentTeamIndex + 1) % teams.length;
            
            // Проверяем условия победы после полного раунда
            if (currentTeamIndex === 0) {
                checkForWinner();
            } else {
                // Продолжаем игру со следующей командой
                showPage('gameScreen');
                prepareRound();
            }
        }

        function checkForWinner() {
            const maxScore = Math.max(...teams.map(team => team.score));
            const teamsWithMaxScore = teams.filter(team => team.score === maxScore);
            
            // Победитель определяется если:
            // 1. Максимальный счет >= минимального для победы
            // 2. И есть команда с явным превосходством
            if (maxScore >= gameSettings.winScore && teamsWithMaxScore.length === 1) {
                endGame();
            } else {
                // Продолжаем игру
                showPage('gameScreen');
                prepareRound();
            }
        }

        function endGame() {
            clearInterval(timer);
            gameEnded = true;
            
            // Находим команду с максимальным счетом
            const maxScore = Math.max(...teams.map(team => team.score));
            const winners = teams.filter(team => team.score === maxScore);
            
            if (winners.length === 1) {
                const winner = winners[0];
                document.getElementById('winnerName').textContent = winner.name;
                document.getElementById('finalScore').textContent = winner.score;
            } else {
                document.getElementById('winnerName').textContent = 'Ничья!';
                document.getElementById('finalScore').textContent = maxScore;
            }
            
            // Рассчитываем призовой фонд
            const prizePool = gameSettings.betAmount * teams.length;
            document.getElementById('prizeAmount').textContent = prizePool;
            
            showPage('finalResults');
            
            // Сохраняем статистику
            saveGameStats(winners.length === 1 ? winners[0] : null);
        }

        function saveGameStats(winner) {
            const stats = JSON.parse(localStorage.getItem('aliasStats') || '[]');
            stats.push({
                date: new Date().toISOString(),
                winner: winner ? winner.name : 'Ничья',
                score: winner ? winner.score : Math.max(...teams.map(team => team.score)),
                teams: teams.map(t => ({ name: t.name, score: t.score }))
            });
            localStorage.setItem('aliasStats', JSON.stringify(stats));
        }

        // Настройка свайпов
        function setupCardSwipe() {
            const card = document.getElementById('gameCard');
            const leftIndicator = document.querySelector('.swipe-indicator.left');
            const rightIndicator = document.querySelector('.swipe-indicator.right');
            const swipeBgLeft = document.getElementById('swipeBgLeft');
            const swipeBgRight = document.getElementById('swipeBgRight');
            
            card.addEventListener('mousedown', startDrag);
            card.addEventListener('touchstart', startDrag, { passive: false });
            
            document.addEventListener('mousemove', drag);
            document.addEventListener('touchmove', drag, { passive: false });
            
            document.addEventListener('mouseup', endDrag);
            document.addEventListener('touchend', endDrag);
            
            function startDrag(e) {
                e.preventDefault();
                isDragging = true;
                startX = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;
                card.classList.add('dragging');
            }
            
            function drag(e) {
                if (!isDragging) return;
                
                e.preventDefault();
                currentX = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;
                const deltaX = currentX - startX;
                
                card.style.transform = `translateX(${deltaX}px) rotate(${deltaX * 0.1}deg)`;
                
                // Показываем индикаторы
                if (deltaX < -50) {
                    leftIndicator.classList.add('active');
                    rightIndicator.classList.remove('active');
                    swipeBgLeft.classList.add('active');
                    swipeBgRight.classList.remove('active');
                } else if (deltaX > 50) {
                    rightIndicator.classList.add('active');
                    leftIndicator.classList.remove('active');
                    swipeBgRight.classList.add('active');
                    swipeBgLeft.classList.remove('active');
                } else {
                    leftIndicator.classList.remove('active');
                    rightIndicator.classList.remove('active');
                    swipeBgLeft.classList.remove('active');
                    swipeBgRight.classList.remove('active');
                }
            }
            
            function endDrag(e) {
                if (!isDragging) return;
                
                isDragging = false;
                card.classList.remove('dragging');
                
                const deltaX = currentX - startX;
                const mode = card.dataset.mode;
                
                if (Math.abs(deltaX) > 100) {
                    if (mode === 'ready' && deltaX > 0) {
                        startRound();
                    } else if (mode === 'game' && !gameEnded) {
                        handleWordResult(deltaX > 0); // вправо = правильно, влево = неправильно
                    }
                }
                
                // Возвращаем карточку на место
                card.style.transform = '';
                leftIndicator.classList.remove('active');
                rightIndicator.classList.remove('active');
                swipeBgLeft.classList.remove('active');
                swipeBgRight.classList.remove('active');
            }
        }

        // Инициализация при загрузке
        window.addEventListener('DOMContentLoaded', init);
        
        // Предотвращение скролла на мобильных устройствах
        document.addEventListener('touchmove', function(e) {
            if (e.target.closest('.game-card')) {
                e.preventDefault();
            }
        }, { passive: false });
    </script>
</body>
</html>
